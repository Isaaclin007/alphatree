//
// Created by yanyu on 2017/11/21.
//

#ifndef ALPHATREE_FILTER_H
#define ALPHATREE_FILTER_H

#include <stddef.h>

class FilterTool{
    public:
        /*
         * target:结果某个指标排序后的盈利
         * size:数据数量
         * minTargetSize:圈选的最小样本数量
         * punishTarget:当圈选样本少于minTargetSize,每少一个样本惩罚一个punishTargetReward
         * outReward:圈选出的平均最大奖励
         * 返回值:返回圈选的数量,如果圈左边就返回正数,如果圈右边就返回负数
         */
        static int group(const float* target, int size, int minTargetSize, float punishTarget, float& maxReward){
            float sumLeft = 0;
            float sumRight = 0;
            int groupSize = size;
            for(int i = 0; i < size; ++i){
                sumLeft += target[i];
                sumRight += target[size-1-i];
                float punishReward = (i > minTargetSize ? 0 : (minTargetSize - i) * punishTarget);
                float leftReward = sumLeft / (i+1) - punishReward;
                if(leftReward > maxReward){
                    maxReward = leftReward;
                    groupSize = i + 1;
                }
                float rightReward = sumRight / (i+1) - punishReward;
                if(rightReward > maxReward){
                    maxReward = rightReward;
                    groupSize = -(i + 1);
                }
            }
            return groupSize;
        }
};

#endif //ALPHATREE_FILTER_H
